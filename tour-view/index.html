---
layout: default
title: íˆ¬ì–´ ìƒì„¸ - DMC íˆ¬ì–´ë§í¬
---

<div id="tourViewContent"><p style="text-align:center;padding:80px 20px;color:var(--gray-500);font-size:18px">ë¡œë”© ì¤‘...</p></div>

<script>
window.addEventListener('load', function(){
  var params = new URLSearchParams(window.location.search);
  var tourId = params.get('id');
  var container = document.getElementById('tourViewContent');
  if (!tourId) { container.innerHTML = '<p style="text-align:center;color:#c62828;padding:80px">íˆ¬ì–´ IDê°€ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>'; return; }
  if (typeof db === 'undefined') { container.innerHTML = '<p style="text-align:center;color:#c62828;padding:80px">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨</p>'; return; }

  db.collection('parsed_tours').doc(tourId).get().then(function(doc) {
    if (!doc.exists || doc.data().status !== 'approved') {
      container.innerHTML = '<p style="text-align:center;color:#c62828;padding:80px">íˆ¬ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ì•„ì§ ìŠ¹ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    var d = doc.data();
    var name = d.title || d.tourName || '';
    var dest = (d.countryName||'') + (d.city ? ' Â· '+d.city : '');
    var imgUrl = d.imageUrl || (d.image && d.image.match(/^https?:\/\//) ? d.image : '');
    var emoji = (!imgUrl && d.image) ? d.image : 'ğŸŒ';
    var priceStr = d.priceFrom ? '$' + d.priceFrom : (d.price || 'ë¬¸ì˜');
    var dmcName = d.operatorName || d.dmcName || '';
    var included = d.included || d.includes || [];
    var excluded = d.excluded || d.excludes || [];
    var langs = d.languages || [];

    var html = '';

    // â”€â”€ Hero â”€â”€
    html += '<div class="detail-hero-v2">';
    if (imgUrl) {
      html += '<div class="hero-gallery"><div class="hero-gallery-main"><img src="'+esc(imgUrl)+'" alt="'+esc(name)+'"></div></div>';
    } else {
      html += '<div class="detail-hero-fallback"><span class="hero-emoji">'+emoji+'</span></div>';
    }
    html += '</div>';

    // â”€â”€ Title Bar â”€â”€
    html += '<div class="detail-title-bar"><div class="container">';
    html += '<p class="detail-breadcrumb">'+esc(d.countryName||'')+' Â· '+esc(d.city||'')+' Â· '+esc(d.category||'')+'</p>';
    html += '<h1>'+esc(name)+'</h1>';
    html += '</div></div>';

    // â”€â”€ Summary Bar â”€â”€
    html += '<div class="container"><div class="summary-bar">';
    if (d.duration) html += '<div class="summary-item"><div class="summary-icon">ğŸ“…</div><div class="summary-label">ê¸°ê°„</div><div class="summary-value">'+esc(d.duration)+'</div></div>';
    if (dest) html += '<div class="summary-item"><div class="summary-icon">ğŸ“</div><div class="summary-label">ëª©ì ì§€</div><div class="summary-value">'+esc(dest)+'</div></div>';
    if (langs.length) html += '<div class="summary-item"><div class="summary-icon">ğŸ—£ï¸</div><div class="summary-label">ê°€ì´ë“œ ì–¸ì–´</div><div class="summary-value">'+esc(langs.join(', '))+'</div></div>';
    if (d.groupSize) html += '<div class="summary-item"><div class="summary-icon">ğŸ‘¥</div><div class="summary-label">ê·¸ë£¹ í¬ê¸°</div><div class="summary-value">ìµœëŒ€ '+esc(String(d.groupSize))+'ëª…</div></div>';
    html += '</div></div>';

    // â”€â”€ Main + Sidebar Layout â”€â”€
    html += '<div class="container detail-layout"><div class="detail-main">';

    // Description
    if (d.description) {
      html += '<div class="detail-section"><h2 class="section-title">ğŸ“‹ íˆ¬ì–´ ì†Œê°œ</h2>';
      html += '<p class="detail-desc">'+esc(d.description)+'</p>';
      if (d.highlights && d.highlights.length) {
        html += '<h3 class="detail-subtitle">âœ¨ í•˜ì´ë¼ì´íŠ¸</h3><ul class="highlight-list">';
        d.highlights.forEach(function(h){ html += '<li><span class="hl-icon">â­</span> '+esc(String(h))+'</li>'; });
        html += '</ul>';
      }
      html += '</div>';
    }

    // Itinerary Timeline
    if (d.itinerary && d.itinerary.length) {
      html += '<div class="detail-section"><h2 class="section-title">ğŸ—“ï¸ ìƒì„¸ ì¼ì •</h2><div class="timeline-v2">';
      d.itinerary.forEach(function(item, idx){
        var isObj = typeof item === 'object' && item !== null;
        var dayNum = isObj && item.day ? item.day : (idx+1);
        var dayTitle = isObj && item.title ? item.title : (typeof item === 'string' ? item : '');
        var dayDesc = isObj && item.description ? item.description : '';

        html += '<div class="tl-day" data-day="'+dayNum+'">';
        html += '<div class="tl-marker"><span>'+dayNum+'</span></div>';
        html += '<div class="tl-content">';
        html += '<div class="tl-header" onclick="toggleAccordion(this)">';
        html += '<h3>Day '+dayNum;
        if (dayTitle) html += ' â€” '+esc(dayTitle);
        html += '</h3><span class="tl-toggle">â–¼</span></div>';
        html += '<div class="tl-body open">';
        if (dayDesc) html += '<p class="tl-desc">'+esc(dayDesc)+'</p>';
        if (isObj && item.stops && item.stops.length) {
          html += '<div class="tl-detail-row"><span class="tl-detail-icon">ğŸ“</span><div class="tl-detail-content"><strong>ë°©ë¬¸ì§€:</strong> '+esc(item.stops.join(' â†’ '))+'</div></div>';
        }
        if (isObj && item.activities && item.activities.length) {
          html += '<div class="tl-detail-row"><span class="tl-detail-icon">ğŸ¯</span><div class="tl-detail-content"><strong>í¬í•¨ ì•¡í‹°ë¹„í‹°:</strong><ul class="tl-act-list">';
          item.activities.forEach(function(a){ html += '<li>'+esc(a)+'</li>'; });
          html += '</ul></div></div>';
        }
        if (isObj && item.transport) {
          html += '<div class="tl-detail-row"><span class="tl-detail-icon">ğŸšŒ</span><div class="tl-detail-content"><strong>ì´ë™ìˆ˜ë‹¨:</strong> '+esc(item.transport)+'</div></div>';
        }
        // Meal badges
        if (isObj && item.meals) {
          html += '<div class="tl-badges">';
          if (item.meals.breakfast) html += '<span class="meal-badge">ğŸ³ ì¡°ì‹</span>';
          if (item.meals.lunch) html += '<span class="meal-badge">ğŸ½ï¸ ì¤‘ì‹</span>';
          if (item.meals.dinner) html += '<span class="meal-badge">ğŸŒ™ ì„ì‹</span>';
          html += '</div>';
        }
        if (isObj && item.accommodation) {
          html += '<div class="tl-detail-row"><span class="tl-detail-icon">ğŸ¨</span><div class="tl-detail-content"><strong>ìˆ™ë°•:</strong> '+esc(item.accommodation)+'</div></div>';
        }
        html += '</div></div></div>';
      });
      html += '</div></div>';
    }

    // Inclusions / Exclusions
    if (included.length || excluded.length) {
      html += '<div class="detail-section"><h2 class="section-title">ğŸ“‹ í¬í•¨ / ë¶ˆí¬í•¨ ì‚¬í•­</h2>';
      html += '<div class="inclusions-v2">';
      if (included.length) {
        html += '<div class="incl-col incl-yes"><h3>âœ… í¬í•¨ ì‚¬í•­</h3><ul>';
        included.forEach(function(i){ html += '<li>'+esc(String(i))+'</li>'; });
        html += '</ul></div>';
      }
      if (excluded.length) {
        html += '<div class="incl-col incl-no"><h3>âŒ ë¶ˆí¬í•¨ ì‚¬í•­</h3><ul>';
        excluded.forEach(function(i){ html += '<li>'+esc(String(i))+'</li>'; });
        html += '</ul></div>';
      }
      html += '</div></div>';
    }

    // Tags
    if (d.tags && d.tags.length) {
      html += '<div class="detail-section"><div style="display:flex;flex-wrap:wrap;gap:8px">';
      d.tags.forEach(function(tag){ html += '<span class="tag-badge">#'+esc(tag)+'</span>'; });
      html += '</div></div>';
    }

    // Operator Info
    if (dmcName) {
      html += '<div class="detail-section"><h2 class="section-title">ğŸ¢ ìš´ì˜ì‚¬ ì •ë³´</h2>';
      html += '<div class="operator-card-v2"><div class="op-header">';
      html += '<span class="op-logo">ğŸ¢</span>';
      html += '<div class="op-info"><h3>'+esc(dmcName)+'</h3>';
      if (dest) html += '<p>'+esc(dest)+'</p>';
      html += '</div></div></div></div>';
    }

    html += '</div>'; // /detail-main

    // â”€â”€ Sidebar â”€â”€
    html += '<aside class="detail-sidebar"><div class="booking-card">';
    html += '<div class="booking-price"><span class="booking-from">From</span>';
    html += '<span class="booking-amount">'+esc(priceStr)+'</span>';
    html += '<span class="booking-per">/1ì¸</span></div>';
    html += '<div class="booking-meta">';
    if (d.duration) html += '<div>ğŸ“… '+esc(d.duration)+'</div>';
    if (d.groupSize) html += '<div>ğŸ‘¥ ìµœëŒ€ '+esc(String(d.groupSize))+'ëª…</div>';
    if (langs.length) html += '<div>ğŸ—£ï¸ '+esc(langs.join(', '))+'</div>';
    html += '</div>';
    html += '<button class="btn btn-primary btn-lg booking-btn" onclick="openInquiryForTour()">ë¬¸ì˜í•˜ê¸°</button>';
    html += '</div></aside>';

    html += '</div>'; // /detail-layout

    // â”€â”€ CTA â”€â”€
    html += '<div class="cta-section"><div class="container">';
    html += '<h2>ì´ íˆ¬ì–´ê°€ ë§ˆìŒì— ë“œì…¨ë‚˜ìš”?</h2>';
    html += '<p>DMC íˆ¬ì–´ë§í¬ê°€ í˜„ì§€ ìš´ì˜ì‚¬ì™€ ì§ì ‘ ì—°ê²°í•´ë“œë¦½ë‹ˆë‹¤.</p>';
    html += '<div class="cta-buttons"><button class="btn btn-primary btn-lg" onclick="openInquiryForTour()">ë¬¸ì˜í•˜ê¸°</button></div>';
    html += '</div></div>';

    container.innerHTML = html;

    // Update page title
    if (name) document.title = name + ' - DMC íˆ¬ì–´ë§í¬';

    // Inquiry handler
    window.openInquiryForTour = function() {
      if (typeof openInquiry === 'function') {
        openInquiry(name, d.duration||'', priceStr, dmcName, '');
      } else if (typeof InquirySystem !== 'undefined' && InquirySystem.openInquiryModal) {
        InquirySystem.openInquiryModal(name, dmcName);
      } else {
        alert('ë¬¸ì˜ ì‹œìŠ¤í…œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    };

  }).catch(function(e) {
    console.error('tour-view error:', e);
    container.innerHTML = '<p style="text-align:center;color:#c62828;padding:80px">íˆ¬ì–´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
  });

  function esc(s){if(!s)return'';var el=document.createElement('div');el.textContent=s;return el.innerHTML}
});
</script>
