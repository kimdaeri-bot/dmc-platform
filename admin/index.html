---
layout: default
title: ë°±ì˜¤í”¼ìŠ¤ - DMC íˆ¬ì–´ë§í¬
---

<style>
.admin-wrap{max-width:var(--max-width);margin:0 auto;padding:32px 20px}
.admin-title{font-size:28px;font-weight:900;color:var(--navy);margin-bottom:24px}
.admin-tabs{display:flex;gap:4px;border-bottom:2px solid var(--gray-200);margin-bottom:24px}
.admin-tab{padding:12px 24px;font-size:15px;font-weight:700;color:var(--gray-700);cursor:pointer;border:none;background:none;border-bottom:3px solid transparent;transition:all .2s}
.admin-tab.active{color:var(--navy);border-bottom-color:var(--orange)}
.admin-tab:hover{color:var(--navy)}
.admin-panel{display:none}.admin-panel.active{display:block}
.member-table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:var(--shadow)}
.member-table th{background:var(--navy);color:#fff;padding:12px 16px;text-align:left;font-size:13px;font-weight:700}
.member-table td{padding:12px 16px;border-bottom:1px solid var(--gray-200);font-size:14px}
.member-table tr:hover td{background:var(--gray-50)}
.action-btn{padding:6px 14px;border-radius:6px;border:none;font-size:12px;font-weight:700;cursor:pointer;margin-right:4px}
.btn-approve{background:#e8f5e9;color:#2e7d32}.btn-approve:hover{background:#c8e6c9}
.btn-reject{background:#ffebee;color:#c62828}.btn-reject:hover{background:#ffcdd2}
.btn-status{padding:4px 10px;border-radius:6px;border:1px solid var(--gray-300);font-size:12px;cursor:pointer;background:#fff}
.sub-tabs{display:flex;gap:8px;margin-bottom:16px}
.sub-tab{padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;border:2px solid var(--gray-200);background:#fff;color:var(--gray-700)}
.sub-tab.active{border-color:var(--navy);color:var(--navy);background:#e8eaf6}
.admin-empty{text-align:center;padding:40px;color:var(--gray-500)}
.inq-badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:12px;font-weight:700}
.inq-badge.open{background:#e8f5e9;color:#2e7d32}
.inq-badge.in-progress{background:#fff3e0;color:#e65100}
.inq-badge.closed{background:var(--gray-200);color:var(--gray-700)}
@media(max-width:768px){.member-table{font-size:12px}.member-table th,.member-table td{padding:8px}.admin-tabs{overflow-x:auto}.admin-tab{white-space:nowrap;padding:10px 16px;font-size:13px}}
</style>

<div class="admin-wrap">
  <h1 class="admin-title">ğŸ¢ ë°±ì˜¤í”¼ìŠ¤</h1>
  <div id="adminLoading" style="text-align:center;padding:60px"><p>ê¶Œí•œ í™•ì¸ ì¤‘...</p></div>
  <div id="adminMain" style="display:none">
    <div class="admin-tabs">
      <button class="admin-tab active" onclick="switchTab('members',this)">ğŸ‘¥ íšŒì› ê´€ë¦¬</button>
      <button class="admin-tab" onclick="switchTab('inquiries',this)">ğŸ’¬ ë¬¸ì˜ ê´€ë¦¬</button>
      <button class="admin-tab" onclick="switchTab('products',this)">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</button>
    </div>
    <div class="admin-panel active" id="panel-members"></div>
    <div class="admin-panel" id="panel-inquiries"></div>
    <div class="admin-panel" id="panel-products">
      <div class="admin-empty"><p>ğŸ“¦ ìƒí’ˆ ê´€ë¦¬ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p></div>
    </div>
  </div>
</div>

<script>
var baseUrl = window.BASE_URL || '/dmc-platform';

document.addEventListener('dmcAuthReady', function(e) {
  var u = e.detail;
  if (!u || !u.profile || u.profile.role !== 'admin') {
    document.getElementById('adminLoading').innerHTML =
      '<p style="color:#c62828">â›” ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.</p><a href="' + baseUrl + '/" class="btn btn-outline btn-sm" style="margin-top:16px">í™ˆìœ¼ë¡œ</a>';
    return;
  }
  document.getElementById('adminLoading').style.display = 'none';
  document.getElementById('adminMain').style.display = 'block';
  loadMembers();
  loadAdminInquiries();
});

function switchTab(name, btn) {
  document.querySelectorAll('.admin-tab').forEach(function(t){t.classList.remove('active')});
  document.querySelectorAll('.admin-panel').forEach(function(p){p.classList.remove('active')});
  btn.classList.add('active');
  document.getElementById('panel-' + name).classList.add('active');
}

// === Members ===
var memberFilter = 'pending';
function loadMembers() {
  var panel = document.getElementById('panel-members');
  panel.innerHTML = '<div class="sub-tabs">' +
    '<button class="sub-tab' + (memberFilter==='pending'?' active':'') + '" onclick="memberFilter=\'pending\';loadMembers()">â³ ìŠ¹ì¸ ëŒ€ê¸°</button>' +
    '<button class="sub-tab' + (memberFilter==='approved'?' active':'') + '" onclick="memberFilter=\'approved\';loadMembers()">âœ… ìŠ¹ì¸ë¨</button>' +
    '<button class="sub-tab' + (memberFilter==='all'?' active':'') + '" onclick="memberFilter=\'all\';loadMembers()">ğŸ“‹ ì „ì²´</button>' +
    '</div><div id="memberList"><p>ë¡œë”© ì¤‘...</p></div>';

  var q = db.collection('users');
  if (memberFilter !== 'all') q = q.where('status', '==', memberFilter);

  q.get().then(function(snap) {
    var list = document.getElementById('memberList');
    if (snap.empty) { list.innerHTML = '<div class="admin-empty"><p>íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>'; return; }
    var html = '<table class="member-table"><thead><tr><th>íšŒì‚¬ëª…</th><th>ë‹´ë‹¹ì</th><th>ì´ë©”ì¼</th><th>ì—­í• </th><th>ìƒíƒœ</th><th>ê°€ì…ì¼</th><th>ê´€ë¦¬</th></tr></thead><tbody>';
    snap.forEach(function(doc) {
      var d = doc.data();
      var date = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleDateString('ko-KR') : '-';
      var role = {agency:'ì—¬í–‰ì‚¬',dmc:'DMC',admin:'ê´€ë¦¬ì'}[d.role] || d.role;
      var status = {pending:'ëŒ€ê¸°',approved:'ìŠ¹ì¸',rejected:'ê±°ì ˆ'}[d.status] || d.status;
      html += '<tr><td>' + esc(d.companyNameKr) + '</td><td>' + esc(d.contactName) + '</td><td>' + esc(d.email) + '</td>' +
        '<td>' + role + '</td><td>' + status + '</td><td>' + date + '</td><td>';
      if (d.status === 'pending') {
        html += '<button class="action-btn btn-approve" onclick="approveMember(\'' + doc.id + '\')">ìŠ¹ì¸</button>' +
          '<button class="action-btn btn-reject" onclick="rejectMember(\'' + doc.id + '\')">ê±°ì ˆ</button>';
      } else if (d.status === 'approved') {
        html += '<span style="color:var(--gray-500);font-size:12px">ìŠ¹ì¸ë¨</span>';
      }
      html += '</td></tr>';
    });
    html += '</tbody></table>';
    list.innerHTML = html;
  });
}

function approveMember(uid) {
  if (!confirm('ì´ íšŒì›ì„ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  db.collection('users').doc(uid).update({
    status: 'approved',
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }).then(function(){ loadMembers(); });
}

function rejectMember(uid) {
  if (!confirm('ì´ íšŒì›ì„ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  db.collection('users').doc(uid).update({
    status: 'rejected',
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }).then(function(){ loadMembers(); });
}

// === Inquiries ===
function loadAdminInquiries() {
  var panel = document.getElementById('panel-inquiries');
  panel.innerHTML = '<div id="adminInqList"><p>ë¡œë”© ì¤‘...</p></div>';

  db.collection('inquiries').orderBy('createdAt', 'desc').get().then(function(snap) {
    var list = document.getElementById('adminInqList');
    if (snap.empty) { list.innerHTML = '<div class="admin-empty"><p>ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>'; return; }
    var html = '<table class="member-table"><thead><tr><th>íˆ¬ì–´</th><th>ì œëª©</th><th>ë¬¸ì˜ì</th><th>ìƒíƒœ</th><th>ë‚ ì§œ</th><th>ê´€ë¦¬</th></tr></thead><tbody>';
    snap.forEach(function(doc) {
      var d = doc.data();
      var date = d.createdAt ? new Date(d.createdAt.seconds * 1000).toLocaleDateString('ko-KR') : '-';
      html += '<tr><td>' + esc(d.tourTitle) + '</td><td>' + esc(d.subject) + '</td><td>' + esc(d.agencyName) + '</td>' +
        '<td><span class="inq-badge ' + d.status + '">' + statusLabel(d.status) + '</span></td><td>' + date + '</td>' +
        '<td><select class="btn-status" onchange="changeInqStatus(\'' + doc.id + '\',this.value)">' +
        '<option value="open"' + (d.status==='open'?' selected':'') + '>ì ‘ìˆ˜</option>' +
        '<option value="in-progress"' + (d.status==='in-progress'?' selected':'') + '>ì§„í–‰ì¤‘</option>' +
        '<option value="closed"' + (d.status==='closed'?' selected':'') + '>ì™„ë£Œ</option></select></td></tr>';
    });
    html += '</tbody></table>';
    list.innerHTML = html;
  });
}

function changeInqStatus(id, status) {
  InquirySystem.updateInquiryStatus(id, status).then(function() {
    loadAdminInquiries();
  });
}

function statusLabel(s){return{open:'ì ‘ìˆ˜','in-progress':'ì§„í–‰ì¤‘',closed:'ì™„ë£Œ'}[s]||s}
function esc(s){if(!s)return'';var d=document.createElement('div');d.textContent=s;return d.innerHTML}
</script>
